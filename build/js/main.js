var Img=function(i,a){this.date=i,this.src=a,this.day,this.collect()};Img.prototype.collect=function(){Img.instances.indexOf(this)===-1&&Img.instances.push(this)},Img.prototype.render=function(){$("#image-container").append('<div class="image-wrapper"><div class="view"><img src="img/img-loading.gif" data-src=/gallery/'+this.src+'></div><div class="filter-indicator day'+this.day+'"></div></div>')},Img.instances=[];var numOfDays=[],initPage=function(){function i(){numOfDays=e.reduce(function(i,a){return i.indexOf(a)<0&&i.push(a),i},[])}function a(){Img.instances.forEach(function(i){i.day=numOfDays.indexOf(i.date)+1})}function s(){Img.instances.forEach(function(i){i.render()})}var t="/gallery/",e=[];$.ajax({url:t,success:function(i){$(i).find("a").attr("href",function(i,a){if(a.match(/\.(jpe?g|png|gif)$/)){var s=a.match(/\d+(?=_)/g);e.push(s[0]);new Img(s[0],a)}})},complete:function(){i(),a(),s(),lazyLoad.loadImages(),nav.renderBtns()}})}(),lazyLoad=function(){function i(i){var a=i.getBoundingClientRect();return a.top>=-300&&a.left>=-300&&a.bottom/1.4<=$(window).height()&&a.right<=$(window).width()+300}function a(i){setInterval(i,300)}function s(){e&&(e=!1,t())}function t(){var a=$("#image-container img");a.each(function(a){i(this)&&$(this).attr("src",$(this).attr("data-src"))})}var e=!1,n=$(window);return n.on("resize scroll",function(){e=!0,events.emit("scrolled")}),a(s),{loadImages:t}}(),nav=function(){function i(){var i=""+100/(numOfDays.length/.94)+"%";if(numOfDays.length>7)alert("Date range of images present in img/gallery folder must not span more than 7 days");else for(var a=0;a<numOfDays.length;a++)c.find("ul").append('<li class="day'+(a+1)+'">'+m[a]+"</li>"),f.find("ul").append('<li class="day'+(a+1)+'">Reset</li>');d.find("li").css("width",i)}function a(){n.scrollTop()>=l?(d.removeClass("layout-fluid-full-width").addClass("nav-fixed"),r.removeClass("layout-fluid-full-width").addClass("filter-indicator-main-fixed")):n.scrollTop()<=l&&(d.removeClass("nav-fixed").addClass("layout-fluid-full-width"),r.removeClass("filter-indicator-main-fixed").addClass("layout-fluid-full-width"))}function s(i){var a=i.attr("class").split(" ")[0];f.find("li").removeClass("active"),c.find("li").removeClass("slide-up"),i.hasClass("slide-down")?(i.removeClass("slide-down").addClass("slide-up"),t(),filterImgs.resetFilter()):(c.find(".slide-down").removeClass("slide-down").addClass("slide-up"),i.addClass("slide-down"),f.find("."+a).addClass("active"),t(),e(i),filterImgs.applyFilter(i))}function t(){r.removeClass(function(i,a){return(a.match(/(day)\d+/)||[]).join(" ")})}function e(i){var a=i.attr("class").split(" ")[0];r.addClass(a)}var n=$(window),l=$("#filter-nav").offset().top,d=$("nav"),r=$(".filter-indicator-main"),o=d.find("ul"),c=$("#filter-nav"),f=$("#reset-nav"),m=["Day One","Day Two","Day Three","Day Four","Day Five","Day Six","Day Seven"];return events.on("scrolled",a),o.on("click","li",function(){s($(this))}),{btnLabels:m,renderBtns:i}}(),filterImgs=function(){function i(i){var a=i.attr("class").split(" ")[0];$(".image-wrapper").each(function(i){$(this).find(".filter-indicator").hasClass(a)?$(this).find(".filter-indicator").hasClass(a)&&$(this).show():$(this).hide(),$(this).find("img").attr("src","img/img-loading.gif")}),setTimeout(lazyLoad.loadImages,50)}function a(){$(".image-wrapper").each(function(i){$(this).show(),$(this).find("img").attr("src","img/img-loading.gif")}),setTimeout(lazyLoad.loadImages,50)}$(".filter-indicator-main");return{resetFilter:a,applyFilter:i}}(),viewImg=function(){function i(){var i=$(".image-wrapper-active").next();if("none"!==i.css("display")&&"undefined"!=typeof i.css("display")){$(".filter-indicator").css("visibility","visible"),d.find("#day").removeClass();var a=i.find(".filter-indicator").attr("class").split(" ")[1].match(/\d/)[0],t=i.find(".filter-indicator").attr("class").split(" ")[1];s(),l.addClass("no-scroll"),d.find("#day").html(nav.btnLabels[a-1]),d.find("#day").addClass(t),i.addClass("image-wrapper-active"),i.find(".view").addClass("view-active"),i.find(".filter-indicator").css("visibility","hidden"),lazyLoad.loadImages()}}function a(){var i=$(".image-wrapper-active").prev();if("none"!==i.css("display")&&"undefined"!=typeof i.css("display")){$(".filter-indicator").css("visibility","visible"),d.find("#day").removeClass();var a=i.find(".filter-indicator").attr("class").split(" ")[1].match(/\d/)[0],t=i.find(".filter-indicator").attr("class").split(" ")[1];s(),l.addClass("no-scroll"),d.find("#day").html(nav.btnLabels[a-1]),d.find("#day").addClass(t),i.addClass("image-wrapper-active"),i.find(".view").addClass("view-active"),i.find(".filter-indicator").css("visibility","hidden"),lazyLoad.loadImages()}}function s(){$(".image-wrapper").removeClass("image-wrapper-active"),$(".view").removeClass("view-active"),l.removeClass("no-scroll")}function t(i){var a=i.find(".filter-indicator").attr("class").split(" ")[1].match(/\d/)[0],s=i.find(".filter-indicator").attr("class").split(" ")[1];d.find("#day").removeClass(),l.addClass("no-scroll"),n.show(),i.addClass("image-wrapper-active"),i.find(".view").addClass("view-active"),i.find(".filter-indicator").css("visibility","hidden"),d.find("#day").html(nav.btnLabels[a-1]),d.find("#day").addClass(s)}var e=$("#image-container"),n=$("#modal"),l=$("body"),d=$("#modal-nav");$(".image-wrapper-active");e.on("click",".image-wrapper",function(i){s(),t($(this))}),n.on("click",function(t){t.target==t.currentTarget||"close"==t.target.className?(s(),$(".filter-indicator").css("visibility","visible"),n.hide()):"next"==t.target.className?i():"prev"==t.target.className&&a()})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiSW1nIiwiZGF0ZSIsInNyYyIsInRoaXMiLCJkYXkiLCJjb2xsZWN0IiwicHJvdG90eXBlIiwiaW5zdGFuY2VzIiwiaW5kZXhPZiIsInB1c2giLCJyZW5kZXIiLCIkIiwiYXBwZW5kIiwibnVtT2ZEYXlzIiwiaW5pdFBhZ2UiLCJjYWxjTnVtRGF5cyIsImRhdGVzQ29sbGVjdGlvbiIsInJlZHVjZSIsImEiLCJiIiwic2V0SW1nc0RheSIsImZvckVhY2giLCJlbCIsInJlbmRlckltZ3MiLCJkaXIiLCJhamF4IiwidXJsIiwic3VjY2VzcyIsImRhdGEiLCJmaW5kIiwiYXR0ciIsImkiLCJ2YWwiLCJtYXRjaCIsImNvbXBsZXRlIiwibGF6eUxvYWQiLCJsb2FkSW1hZ2VzIiwibmF2IiwicmVuZGVyQnRucyIsImlzRWxlbWVudEluVmlld3BvcnQiLCJyZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwibGVmdCIsImJvdHRvbSIsIndpbmRvdyIsImhlaWdodCIsInJpZ2h0Iiwid2lkdGgiLCJzZXRTY3JvbGxJbnRlcnZhbCIsImZuIiwic2V0SW50ZXJ2YWwiLCJzY3JvbGxIYW5kbGVyIiwiZGlkU2Nyb2xsIiwiJGltYWdlcyIsImVhY2giLCJpbmRleCIsIiR3aW5kb3ciLCJvbiIsImV2ZW50cyIsImVtaXQiLCJidG5XaWR0aCIsImxlbmd0aCIsImFsZXJ0IiwiJGZpbHRlck5hdiIsImJ0bkxhYmVscyIsIiRyZXNldE5hdiIsIiRuYXYiLCJjc3MiLCJzdGlja3lOYXYiLCJzY3JvbGxUb3AiLCIkZGlzdGFuY2UiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiJGZpbHRlck1haW4iLCJuYXZBbmltYXRpb25zIiwiJHRoaXMiLCJjbGlja2VkQ2xhc3MiLCJzcGxpdCIsImhhc0NsYXNzIiwicmVzZXRGaWx0ZXJDb2xvciIsImZpbHRlckltZ3MiLCJyZXNldEZpbHRlciIsImFwcGx5RmlsdGVyQ29sb3IiLCJhcHBseUZpbHRlciIsImpvaW4iLCJvZmZzZXQiLCIkdWwiLCJzaG93IiwiaGlkZSIsInNldFRpbWVvdXQiLCJ2aWV3SW1nIiwibmV4dCIsIiRuZXh0UGljIiwiJG1vZGFsTmF2IiwiZGF5TnVtIiwicmVzZXQiLCIkYm9keSIsImh0bWwiLCJwcmV2IiwiJHByZXZQaWMiLCJ2aWV3QWN0aXZlIiwiJG1vZGFsIiwiJGltZ0NvbnRhaW5lciIsImUiLCJ0YXJnZXQiLCJjdXJyZW50VGFyZ2V0IiwiY2xhc3NOYW1lIl0sIm1hcHBpbmdzIjoiQUFDQSxHQUFJQSxLQUFNLFNBQVVDLEVBQU1DLEdBQ3RCQyxLQUFLRixLQUFPQSxFQUNaRSxLQUFLRCxJQUFNQSxFQUNYQyxLQUFLQyxJQUVMRCxLQUFLRSxVQUdUTCxLQUFJTSxVQUFVRCxRQUFVLFdBQ2hCTCxJQUFJTyxVQUFVQyxRQUFRTCxTQUFVLEdBQ2hDSCxJQUFJTyxVQUFVRSxLQUFLTixPQUkzQkgsSUFBSU0sVUFBVUksT0FBUyxXQUVuQkMsRUFBRSxvQkFBb0JDLE9BQU8saUdBQXNHVCxLQUFLRCxJQUFNLDBDQUE0Q0MsS0FBS0MsSUFBTSxtQkFHek1KLElBQUlPLFlBR0osSUFBSU0sY0FFQUMsU0FBVyxXQTZCWCxRQUFTQyxLQUNMRixVQUFZRyxFQUFnQkMsT0FBTyxTQUFVQyxFQUFHQyxHQUU1QyxNQURJRCxHQUFFVixRQUFRVyxHQUFLLEdBQUdELEVBQUVULEtBQUtVLEdBQ3RCRCxPQUlmLFFBQVNFLEtBQ0xwQixJQUFJTyxVQUFVYyxRQUFRLFNBQVVDLEdBQzVCQSxFQUFHbEIsSUFBTVMsVUFBVUwsUUFBUWMsRUFBR3JCLE1BQVEsSUFJOUMsUUFBU3NCLEtBQ0x2QixJQUFJTyxVQUFVYyxRQUFRLFNBQVVDLEdBQzVCQSxFQUFHWixXQTNDWCxHQUFJYyxHQUFNLFlBQ05SLElBRUpMLEdBQUVjLE1BQ0VDLElBQUtGLEVBQ0xHLFFBQVMsU0FBVUMsR0FFZmpCLEVBQUVpQixHQUFNQyxLQUFLLEtBQUtDLEtBQUssT0FBUSxTQUFVQyxFQUFHQyxHQUV4QyxHQUFJQSxF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LEdBQUltQixHQUFTbkIsRUFBTS9DLEtBQUsscUJBQXFCQyxLQUFLLFNBQVNnRCxNQUFNLEtBQUssR0FBRzdDLE1BQU0sTUFBTSxHQUNqRjRDLEVBQWVELEVBQU0vQyxLQUFLLHFCQUFxQkMsS0FBSyxTQUFTZ0QsTUFBTSxLQUFLLEVBRTVFZ0IsR0FBVWpFLEtBQUssUUFBUTJDLGNBRXZCeUIsRUFBTXhCLFNBQVMsYUFDZjZCLEVBQU9kLE9BQ1BaLEVBQU1ILFNBQVMsd0JBQ2ZHLEVBQU0vQyxLQUFLLFNBQVM0QyxTQUFTLGVBQzdCRyxFQUFNL0MsS0FBSyxxQkFBcUJ1QyxJQUFJLGFBQWMsVUFFbEQwQixFQUFVakUsS0FBSyxRQUFRcUUsS0FBSzdELElBQUk0QixVQUFVOEIsRUFBUyxJQUNuREQsRUFBVWpFLEtBQUssUUFBUTRDLFNBQVNJLEdBaEdwQyxHQUFJMEIsR0FBZ0I1RixFQUFFLG9CQUNsQjJGLEVBQVMzRixFQUFFLFVBQ1hzRixFQUFRdEYsRUFBRSxRQUNWbUYsRUFBWW5GLEVBQUUsYUFDREEsR0FBRSx3QkFHbkI0RixHQUFjN0MsR0FBRyxRQUFTLGlCQUFrQixTQUFVOEMsR0FDbERSLElBQ0FLLEVBQVcxRixFQUFFUixTQUdqQm1HLEVBQU81QyxHQUFHLFFBQVMsU0FBVThDLEdBRXJCQSxFQUFFQyxRQUFVRCxFQUFFRSxlQUF1QyxTQUF0QkYsRUFBRUMsT0FBT0UsV0FDeENYLElBQ0FyRixFQUFFLHFCQUFxQnlELElBQUksYUFBYyxXQUN6Q2tDLEVBQU9iLFFBQ3NCLFFBQXRCZSxFQUFFQyxPQUFPRSxVQUNoQmYsSUFDNkIsUUFBdEJZLEVBQUVDLE9BQU9FLFdBQ2hCUiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9Db25zdHJ1Y3RvciBmb3IgaW1hZ2VzIGluIGltZy9nYWxsZXJ5IGZvbGRlclxyXG52YXIgSW1nID0gZnVuY3Rpb24gKGRhdGUsIHNyYykge1xyXG4gICAgdGhpcy5kYXRlID0gZGF0ZTtcclxuICAgIHRoaXMuc3JjID0gc3JjO1xyXG4gICAgdGhpcy5kYXk7XHJcblxyXG4gICAgdGhpcy5jb2xsZWN0KCk7XHJcbn1cclxuLy9vbiBjb25zdHJ1Y3Rpb24gcHVzaCBpbnN0YW5jZSBpbnRvIGFycmF5XHJcbkltZy5wcm90b3R5cGUuY29sbGVjdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmIChJbWcuaW5zdGFuY2VzLmluZGV4T2YodGhpcykgPT09IC0xKSB7XHJcbiAgICAgICAgSW1nLmluc3RhbmNlcy5wdXNoKHRoaXMpO1xyXG4gICAgfVxyXG59O1xyXG4vL3JlbmRlciBtZXRob2QgY3JlYXRlcyBjc3MgY2xhc3NlcyAuaW1hZ2Utd3JhcHBlciwgLnZpZXcgYW5kIC5maWx0ZXItaW5kaWNhdG9yIHdpdGggY2xhc3MgLmRheSB0byBzZXQgY29ycmVzcG9uZGluZyBkYXkgY29sb3JcclxuSW1nLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgJCgnI2ltYWdlLWNvbnRhaW5lcicpLmFwcGVuZCgnPGRpdiBjbGFzcz1cImltYWdlLXdyYXBwZXJcIj48ZGl2IGNsYXNzPVwidmlld1wiPjxpbWcgc3JjPVwiaW1nL2ltZy1sb2FkaW5nLmdpZlwiIGRhdGEtc3JjPScgKyAnL2dhbGxlcnkvJyt0aGlzLnNyYyArICc+PC9kaXY+PGRpdiBjbGFzcz1cImZpbHRlci1pbmRpY2F0b3IgZGF5JyArIHRoaXMuZGF5ICsgJ1wiPjwvZGl2PjwvZGl2PicpO1xyXG59O1xyXG5cclxuSW1nLmluc3RhbmNlcyA9IFtdO1xyXG5cclxuLy9nbG9iYWwgdmFyaWFibGUgdG8gZ2V0IGFyb3VuZCBwcm9ibGVtIG9mIGluaXRQYWdlIHJldHVybmluZyBlbXB0eSBhcnJheS4gVXNlZCBpbiBuYXYucmVuZGVyQnRucyBcclxudmFyIG51bU9mRGF5cyA9IFtdO1xyXG5cclxudmFyIGluaXRQYWdlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBkaXIgPSBcIi9nYWxsZXJ5L1wiO1xyXG4gICAgdmFyIGRhdGVzQ29sbGVjdGlvbiA9IFtdO1xyXG4gICAgLy9sb2NhbCBhamF4IGNhbGxcclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiBkaXIsXHJcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuXHJcbiAgICAgICAgICAgICQoZGF0YSkuZmluZChcImFcIikuYXR0cihcImhyZWZcIiwgZnVuY3Rpb24gKGksIHZhbCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh2YWwubWF0Y2goL1xcLihqcGU/Z3xwbmd8Z2lmKSQvKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlID0gdmFsLm1hdGNoKC9cXGQrKD89XykvZyk7Ly9tYXRjaCBhbGwgZGlnaXRzIGJlZm9yZSBcIl9cIiBUaGlzIGlzIHRoZSBkYXRlIHdoZW4gZGVhbGluZyB3aXRoIGFuZHJvaWQgcGljdHVyZSBuYW1pbmcgY29udmVudGlvbiBcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZXNDb2xsZWN0aW9uLnB1c2goZGF0ZVswXSk7Ly9wdXNoIGFsbCBkYXRlcyBvZiBhbGwgaW1hZ2VzIGludG8gYXJyYXlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlID0gbmV3IEltZyhkYXRlWzBdLCB2YWwpOy8vaW5zdGFudGlhdGUgd2l0aCBkYXRlIGFuZCBzcmMgKHZhbClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY2FsY051bURheXMoKTtcclxuICAgICAgICAgICAgc2V0SW1nc0RheSgpO1xyXG4gICAgICAgICAgICByZW5kZXJJbWdzKCk7XHJcbiAgICAgICAgICAgIGxhenlMb2FkLmxvYWRJbWFnZXMoKTsvL2xvYWQgYWxsIGltYWdlcyBjdXJyZW50bHkgaW4gdmlld3BvcnRcclxuICAgICAgICAgICAgbmF2LnJlbmRlckJ0bnMoKTsvL3BvcHVsYXRlIG5hdmlnYXRpb25cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vaW5wdXQ6IGRhdGVzQ29sbGVjdGlvbiByZXN1bHQ6IHJlbW92ZSBkdXBsaWNhdGUgZGF0ZXMsIG51bU9mRGF5cy5sZW5ndGggaXMgaG93IG1hbnkgZGF5cyB0cmlwIGxhc3RlZFxyXG4gICAgZnVuY3Rpb24gY2FsY051bURheXMoKSB7XHJcbiAgICAgICAgbnVtT2ZEYXlzID0gZGF0ZXNDb2xsZWN0aW9uLnJlZHVjZShmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICBpZiAoYS5pbmRleE9mKGIpIDwgMCkgYS5wdXNoKGIpO1xyXG4gICAgICAgICAgICByZXR1cm4gYTtcclxuICAgICAgICB9LCBbXSk7XHJcbiAgICB9XHJcbiAgICAvL2NoZWNrIHRoZSBkYXRlIHByb3Agb2YgSW1nLmluc3RhbmNlcyBhZ2Fpc250IG51bU9mRGF5cy4gTWF0Y2ggaW5kZXggKyAxIGJlY29tZXMgY29ycmVjdCBkYXkgcGljdHVyZSB3YXMgdGFrZW5cclxuICAgIGZ1bmN0aW9uIHNldEltZ3NEYXkoKSB7XHJcbiAgICAgICAgSW1nLmluc3RhbmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xyXG4gICAgICAgICAgICBlbC5kYXkgPSBudW1PZkRheXMuaW5kZXhPZihlbC5kYXRlKSArIDE7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvL2luamVjdCBIVE1MIGZvciBhbGwgaW1hZ2VzIGludG8gI2ltYWdlLWNvbnRhaW5lciBcclxuICAgIGZ1bmN0aW9uIHJlbmRlckltZ3MoKSB7XHJcbiAgICAgICAgSW1nLmluc3RhbmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xyXG4gICAgICAgICAgICBlbC5yZW5kZXIoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSkoKTtcclxuXHJcbnZhciBsYXp5TG9hZCA9IChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgdmFyIGRpZFNjcm9sbCA9IGZhbHNlO1xyXG5cclxuICAgIC8vY2FjaGUgRE9NXHJcbiAgICB2YXIgJHdpbmRvdyA9ICQod2luZG93KTtcclxuXHJcbiAgICAvL2JpbmQgZXZlbnRzXHJcbiAgICAkd2luZG93Lm9uKCdyZXNpemUgc2Nyb2xsJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGRpZFNjcm9sbCA9IHRydWU7XHJcbiAgICAgICAgZXZlbnRzLmVtaXQoJ3Njcm9sbGVkJyk7Ly9hdm9pZGluZyBtdWx0aXBsZSBzY3JvbGwgZXZlbnQgbGlzdGVuZXJzIG9uIHdpbmRvd1xyXG4gICAgfSk7XHJcblxyXG4gICAgc2V0U2Nyb2xsSW50ZXJ2YWwoc2Nyb2xsSGFuZGxlcik7Ly91c2VkIGZvciB0aHJvdHRsaW5nIHdpbmRvdyBzY3JvbGwgZXZlbnRzLiBcclxuICAgIFxyXG4gICAgLy9jaGVjayBpZiBpbWFnZSBlbGVtZW50IGlzIGluIHZpZXdwb3J0XHJcbiAgICBmdW5jdGlvbiBpc0VsZW1lbnRJblZpZXdwb3J0KGVsKSB7XHJcbiAgICAgICAgdmFyIHJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgcmVjdC50b3AgPj0gLTMwMCAmJlxyXG4gICAgICAgICAgICByZWN0LmxlZnQgPj0gLTMwMCAmJlxyXG4gICAgICAgICAgICByZWN0LmJvdHRvbSAvIDEuNCA8PSAkKHdpbmRvdykuaGVpZ2h0KCkgJiZcclxuICAgICAgICAgICAgcmVjdC5yaWdodCA8PSAkKHdpbmRvdykud2lkdGgoKSArIDMwMFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHNldFNjcm9sbEludGVydmFsKGZuKSB7XHJcbiAgICAgICAgc2V0SW50ZXJ2YWwoZm4sIDMwMCk7XHJcbiAgICB9XHJcbiAgICAvL2NoZWNrIGV2ZXJ5IDMwMG1zIGlmIGEgc2Nyb2xsIGV2ZW50IGhhcyBmaXJlZC4gSWYgdHJ1ZSBsb2FkSW1hZ2VzKClcclxuICAgIGZ1bmN0aW9uIHNjcm9sbEhhbmRsZXIoKSB7XHJcbiAgICAgICAgaWYgKGRpZFNjcm9sbCkge1xyXG4gICAgICAgICAgICBkaWRTY3JvbGwgPSBmYWxzZTtcclxuICAgICAgICAgICAgbG9hZEltYWdlcygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vaWYgaW1hZ2UgaW4gdmlld3BvcnQgJ2xvYWQnIGl0IGJ5IHN3aXRjaGluZyBkYXRhLXNyYyBhbmQgcmVhbCBzcmNcclxuICAgIGZ1bmN0aW9uIGxvYWRJbWFnZXMoKSB7XHJcbiAgICAgICAgdmFyICRpbWFnZXMgPSAkKCcjaW1hZ2UtY29udGFpbmVyIGltZycpO1xyXG5cclxuICAgICAgICAkaW1hZ2VzLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNFbGVtZW50SW5WaWV3cG9ydCh0aGlzKSkge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwic3JjXCIsICQodGhpcykuYXR0cihcImRhdGEtc3JjXCIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbG9hZEltYWdlczogbG9hZEltYWdlc1xyXG4gICAgfVxyXG59KSgpO1xyXG5cclxudmFyIG5hdiA9IChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgLy9jYWNoZSBET01cclxuICAgIHZhciAkd2luZG93ID0gJCh3aW5kb3cpO1xyXG4gICAgdmFyICRkaXN0YW5jZSA9ICQoJyNmaWx0ZXItbmF2Jykub2Zmc2V0KCkudG9wOy8vZGlzdGFuY2Ugc2Nyb2xsZWQgZnJvbSB0b3Agb2YgZG9jdW1lbnRcclxuICAgIHZhciAkbmF2ID0gJCgnbmF2Jyk7XHJcbiAgICB2YXIgJGZpbHRlck1haW4gPSAkKCcuZmlsdGVyLWluZGljYXRvci1tYWluJyk7XHJcbiAgICB2YXIgJHVsID0gJG5hdi5maW5kKCd1bCcpO1xyXG4gICAgdmFyICRmaWx0ZXJOYXYgPSAkKCcjZmlsdGVyLW5hdicpO1xyXG4gICAgdmFyICRyZXNldE5hdiA9ICQoJyNyZXNldC1uYXYnKTtcclxuICAgIFxyXG4gICAgdmFyIGJ0bkxhYmVscyA9IFsnRGF5IE9uZScsICdEYXkgVHdvJywgJ0RheSBUaHJlZScsICdEYXkgRm91cicsICdEYXkgRml2ZScsICdEYXkgU2l4JywgJ0RheSBTZXZlbiddOy8vdXNlZCBmb3IgbmF2IGJ0biBsYWJlbHNcclxuXHJcbiAgICAvL2JpbmQgZXZlbnRzXHJcbiAgICBldmVudHMub24oJ3Njcm9sbGVkJywgc3RpY2t5TmF2KTsvL3dpbmRvdyBzY3JvbGwgZXZlbnQgYm91bmQgaW4gbGF6eWxvYWRcclxuXHJcbiAgICAkdWwub24oJ2NsaWNrJywgJ2xpJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIG5hdkFuaW1hdGlvbnMoJCh0aGlzKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmdW5jdGlvbiByZW5kZXJCdG5zKCkge1xyXG4gICAgICAgIHZhciBidG5XaWR0aCA9ICcnICsgKDEwMCAvIChudW1PZkRheXMubGVuZ3RoIC8gMC45NCkpICsgJyUnOy8vd2lkdGggb2YgYnRucyBpcyBwZXJjZW50IGJhc2VkIG9uIG51bWJlciBvZiBidG5zIG5lZWRlZFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vaW5mb3JtIHVzZXIgdGhlIGRhdGVzIG9mIHRoZWlyIHBpY3VyZXMgc3BhbiB0b28gbWFueSBkYXlzXHJcbiAgICAgICAgaWYgKG51bU9mRGF5cy5sZW5ndGggPiA3KSB7XHJcbiAgICAgICAgICAgIGFsZXJ0KCdEYXRlIHJhbmdlIG9mIGltYWdlcyBwcmVzZW50IGluIGltZy9nYWxsZXJ5IGZvbGRlciBtdXN0IG5vdCBzcGFuIG1vcmUgdGhhbiA3IGRheXMnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvL3JlbmRlciBidG5zIG9uIHBhZ2VcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1PZkRheXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICRmaWx0ZXJOYXYuZmluZCgndWwnKS5hcHBlbmQoJzxsaSBjbGFzcz1cImRheScgKyAoaSArIDEpICsgJ1wiPicgKyBidG5MYWJlbHNbaV0gKyAnPC9saT4nKTtcclxuICAgICAgICAgICAgICAgICRyZXNldE5hdi5maW5kKCd1bCcpLmFwcGVuZCgnPGxpIGNsYXNzPVwiZGF5JyArIChpICsgMSkgKyAnXCI+UmVzZXQ8L2xpPicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vc2V0IGJ0biB3aWR0aFxyXG4gICAgICAgICRuYXYuZmluZCgnbGknKS5jc3MoJ3dpZHRoJywgYnRuV2lkdGgpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBzdGlja3lOYXYoKSB7XHJcbiAgICAgICAgaWYgKCR3aW5kb3cuc2Nyb2xsVG9wKCkgPj0gJGRpc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICRuYXYucmVtb3ZlQ2xhc3MoJ2xheW91dC1mbHVpZC1mdWxsLXdpZHRoJykuYWRkQ2xhc3MoJ25hdi1maXhlZCcpO1xyXG4gICAgICAgICAgICAkZmlsdGVyTWFpbi5yZW1vdmVDbGFzcygnbGF5b3V0LWZsdWlkLWZ1bGwtd2lkdGgnKS5hZGRDbGFzcygnZmlsdGVyLWluZGljYXRvci1tYWluLWZpeGVkJyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICgkd2luZG93LnNjcm9sbFRvcCgpIDw9ICRkaXN0YW5jZSkge1xyXG4gICAgICAgICAgICAkbmF2LnJlbW92ZUNsYXNzKCduYXYtZml4ZWQnKS5hZGRDbGFzcygnbGF5b3V0LWZsdWlkLWZ1bGwtd2lkdGgnKTtcclxuICAgICAgICAgICAgJGZpbHRlck1haW4ucmVtb3ZlQ2xhc3MoJ2ZpbHRlci1pbmRpY2F0b3ItbWFpbi1maXhlZCcpLmFkZENsYXNzKCdsYXlvdXQtZmx1aWQtZnVsbC13aWR0aCcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBuYXZBbmltYXRpb25zKCR0aGlzKSB7XHJcbiAgICAgICAgdmFyIGNsaWNrZWRDbGFzcyA9ICR0aGlzLmF0dHIoJ2NsYXNzJykuc3BsaXQoJyAnKVswXTsvL2dldHMgdGhlIGZpcnN0IGNsYXNzIG9mIGVsZW1lbnQgbGkgKC5kYXk8bnVtYmVyPiBpbiB0aGlzIGNhc2UpLiBVc2VkIGluIHRoZSBtb2R1bGUgdG8gc2V0IGRheSBmaWx0ZXIgY29sb3IuIFxyXG5cclxuICAgICAgICAkcmVzZXROYXYuZmluZCgnbGknKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgJGZpbHRlck5hdi5maW5kKCdsaScpLnJlbW92ZUNsYXNzKCdzbGlkZS11cCcpO1xyXG5cclxuICAgICAgICBpZiAoJHRoaXMuaGFzQ2xhc3MoJ3NsaWRlLWRvd24nKSkge1xyXG4gICAgICAgICAgICAkdGhpcy5yZW1vdmVDbGFzcygnc2xpZGUtZG93bicpLmFkZENsYXNzKCdzbGlkZS11cCcpO1xyXG4gICAgICAgICAgICByZXNldEZpbHRlckNvbG9yKCk7XHJcbiAgICAgICAgICAgIGZpbHRlckltZ3MucmVzZXRGaWx0ZXIoKTsvL21ldGhvZCBmb3IgcmVzdG9yaW5nIGFsbCBwcmV2aW91c2x5IGZpbHRlcmVkIG91dCBpbWFnZXMgaW50byB2aWV3IGFnYWluXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJGZpbHRlck5hdi5maW5kKCcuc2xpZGUtZG93bicpLnJlbW92ZUNsYXNzKCdzbGlkZS1kb3duJykuYWRkQ2xhc3MoJ3NsaWRlLXVwJyk7XHJcbiAgICAgICAgICAgICR0aGlzLmFkZENsYXNzKCdzbGlkZS1kb3duJyk7XHJcbiAgICAgICAgICAgICRyZXNldE5hdi5maW5kKCcuJyArIGNsaWNrZWRDbGFzcykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICByZXNldEZpbHRlckNvbG9yKCk7XHJcbiAgICAgICAgICAgIGFwcGx5RmlsdGVyQ29sb3IoJHRoaXMpO1xyXG4gICAgICAgICAgICBmaWx0ZXJJbWdzLmFwcGx5RmlsdGVyKCR0aGlzKTsvL21ldGhvZCBmb3IgZmlsdGVyaW5nIG91dCBpbWFnZXMgZnJvbSB2aWV3LiBQYXNzICR0aGlzIGZvciBpbmZvIG9uIHdoYXQgLmRheTxudW1iZXI+IHRvIGZpbHRlciBieVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICAvL3JlbW92ZSBhbGwgLmRheTxudW1iZXI+IGNsYXNzZXMgZnJvbSBtYWluIGZpbHRlciBiYXJcclxuICAgIGZ1bmN0aW9uIHJlc2V0RmlsdGVyQ29sb3IoKSB7XHJcbiAgICAgICAgJGZpbHRlck1haW4ucmVtb3ZlQ2xhc3MoZnVuY3Rpb24gKGluZGV4LCBjc3MpIHtcclxuICAgICAgICAgICAgcmV0dXJuIChjc3MubWF0Y2goLyhkYXkpXFxkKy8pIHx8IFtdKS5qb2luKCcgJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvL2FwcGx5IC5kYXk8bnVtYmVyPiBjbGFzc2VzIHRvIG1haW4gZmlsdGVyIGJhclxyXG4gICAgZnVuY3Rpb24gYXBwbHlGaWx0ZXJDb2xvcigkdGhpcykge1xyXG4gICAgICAgIHZhciBjbGlja2VkQ2xhc3MgPSAkdGhpcy5hdHRyKCdjbGFzcycpLnNwbGl0KCcgJylbMF07XHJcblxyXG4gICAgICAgICRmaWx0ZXJNYWluLmFkZENsYXNzKGNsaWNrZWRDbGFzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBidG5MYWJlbHM6IGJ0bkxhYmVscyxcclxuICAgICAgICByZW5kZXJCdG5zOiByZW5kZXJCdG5zXHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG52YXIgZmlsdGVySW1ncyA9IChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgLy9jYWNoZSBET00gXHJcbiAgICB2YXIgJGZpbHRlck1haW4gPSAkKCcuZmlsdGVyLWluZGljYXRvci1tYWluJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gYXBwbHlGaWx0ZXIoJHRoaXMpIHtcclxuICAgICAgICB2YXIgY2xpY2tlZENsYXNzID0gJHRoaXMuYXR0cignY2xhc3MnKS5zcGxpdCgnICcpWzBdOy8vZ2V0cyB0aGUgZmlyc3QgY2xhc3Mgb2YgZWxlbWVudCBsaSAoLmRheTxudW1iZXI+IGluIHRoaXMgY2FzZSkuXHJcbiAgICAgICAgLy91c2UgLmRheTxudW1iZXI+IGNsYXNzIG9mIG5hdiBsaSB0byBmaWx0ZXIgb3V0IGltYWdlcyBmcm9tIHZpZXdcclxuICAgICAgICAkKCcuaW1hZ2Utd3JhcHBlcicpLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgICAgIGlmICghJCh0aGlzKS5maW5kKCcuZmlsdGVyLWluZGljYXRvcicpLmhhc0NsYXNzKGNsaWNrZWRDbGFzcykpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykuaGlkZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCQodGhpcykuZmluZCgnLmZpbHRlci1pbmRpY2F0b3InKS5oYXNDbGFzcyhjbGlja2VkQ2xhc3MpKSB7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnNob3coKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoJ2ltZycpLmF0dHIoXCJzcmNcIiwgJ2ltZy9pbWctbG9hZGluZy5naWYnKTsvL3NldCBpbWFnZXMgYmFjayB0byBsb2FkaW5nIGdpZiB0byBwcmV2ZW50IGJyb3dzZXIgaGF2aW5nIHRvIHJlbmRlciBsb3RzIG9mIGltYWdlcyBhIG9uY2UgYW5kIGxhZ2dpbmcgb3V0XHJcbiAgICAgICAgfSlcclxuICAgICAgICBzZXRUaW1lb3V0KGxhenlMb2FkLmxvYWRJbWFnZXMsIDUwKTsvL2xvYWQgaW1hZ2VzIGluIHZpZXdwb3J0IFxyXG4gICAgfVxyXG4gICAgLy9icmluZyBhbGwgcHJldmlvdXNseSBmaWx0ZXJlZCBpbWFnZXMgYmFjayBpbnRvIHZpZXdcclxuICAgIGZ1bmN0aW9uIHJlc2V0RmlsdGVyKCkge1xyXG4gICAgICAgICQoJy5pbWFnZS13cmFwcGVyJykuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5zaG93KCk7XHJcbiAgICAgICAgICAgICQodGhpcykuZmluZCgnaW1nJykuYXR0cihcInNyY1wiLCAnaW1nL2ltZy1sb2FkaW5nLmdpZicpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgc2V0VGltZW91dChsYXp5TG9hZC5sb2FkSW1hZ2VzLCA1MCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXNldEZpbHRlcjogcmVzZXRGaWx0ZXIsXHJcbiAgICAgICAgYXBwbHlGaWx0ZXI6IGFwcGx5RmlsdGVyXHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG52YXIgdmlld0ltZyA9IChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgLy9jYWNoZSBET01cclxuICAgIHZhciAkaW1nQ29udGFpbmVyID0gJCgnI2ltYWdlLWNvbnRhaW5lcicpO1xyXG4gICAgdmFyICRtb2RhbCA9ICQoJyNtb2RhbCcpO1xyXG4gICAgdmFyICRib2R5ID0gJCgnYm9keScpO1xyXG4gICAgdmFyICRtb2RhbE5hdiA9ICQoJyNtb2RhbC1uYXYnKTtcclxuICAgIHZhciAkaW1nQWN0aXZlID0gJCgnLmltYWdlLXdyYXBwZXItYWN0aXZlJyk7XHJcblxyXG4gICAgLy9iaW5kIGV2ZW50c1xyXG4gICAgJGltZ0NvbnRhaW5lci5vbignY2xpY2snLCAnLmltYWdlLXdyYXBwZXInLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHJlc2V0KCk7XHJcbiAgICAgICAgdmlld0FjdGl2ZSgkKHRoaXMpKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAkbW9kYWwub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAvL2NsaWNrcyBvbiBtb2RhbCBpdHNlbGYgb3IgJ1gnIGNsb3NlIG1vZGFsIGFuZCBtaW5pbWl6ZSBlbmxhcmdlZCBpbWFnZVxyXG4gICAgICAgIGlmIChlLnRhcmdldCA9PSBlLmN1cnJlbnRUYXJnZXQgfHwgZS50YXJnZXQuY2xhc3NOYW1lID09ICdjbG9zZScpIHtcclxuICAgICAgICAgICAgcmVzZXQoKTtcclxuICAgICAgICAgICAgJCgnLmZpbHRlci1pbmRpY2F0b3InKS5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpOy8vYWxsIHRvZ2dsaW5nIG9mIGZpbHRlciBpbmRpY2F0b3IgdmlzaWJpbGl0eSBpcyB0byBnZXQgaXQgb3V0IG9mIHRoZSB3YXkgd2hlbiBlbmxhcmdpbmcgYW4gaW1hZ2VcclxuICAgICAgICAgICAgJG1vZGFsLmhpZGUoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSAnbmV4dCcpIHtcclxuICAgICAgICAgICAgbmV4dCgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09ICdwcmV2Jykge1xyXG4gICAgICAgICAgICBwcmV2KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gbmV4dCgpIHtcclxuICAgICAgICB2YXIgJG5leHRQaWMgPSAkKCcuaW1hZ2Utd3JhcHBlci1hY3RpdmUnKS5uZXh0KCk7Ly9zdG9yZSB0aGUgbmV4dCBpbWFnZSB0aGF0IG5lZWRzIHRvIGJlIGRpc3BsYXllZFxyXG4gICAgICAgIC8vZGlzYWxsb3cgbmF2aWdhdGluZyB0byBjdXJyZW50bHkgZmlsdGVyZWQgb3V0IGltYWdlcyBvciBwYXN0IHRoZSBiZWdpbm5pbmcvZW5kIG9mIGdhbGxlcnlcclxuICAgICAgICBpZiAoJG5leHRQaWMuY3NzKCdkaXNwbGF5JykgPT09ICdub25lJyB8fCB0eXBlb2YgJG5leHRQaWMuY3NzKCdkaXNwbGF5JykgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgJCgnLmZpbHRlci1pbmRpY2F0b3InKS5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xyXG5cclxuICAgICAgICAkbW9kYWxOYXYuZmluZCgnI2RheScpLnJlbW92ZUNsYXNzKCk7XHJcblxyXG4gICAgICAgIHZhciBkYXlOdW0gPSAkbmV4dFBpYy5maW5kKCcuZmlsdGVyLWluZGljYXRvcicpLmF0dHIoJ2NsYXNzJykuc3BsaXQoJyAnKVsxXS5tYXRjaCgvXFxkLylbMF07Ly9nZXQgdGhlIG51bWJlciBvZiAuZGF5PG51bWJlcj4gY2xhc3Mgb2YgbmV4dCBpbWFnZSBlbGVtZW50IHRvIHVzZSB3aXRoIG5hdi5idG5MYWJlbHMgYXJyXHJcbiAgICAgICAgdmFyIGNsaWNrZWRDbGFzcyA9ICRuZXh0UGljLmZpbmQoJy5maWx0ZXItaW5kaWNhdG9yJykuYXR0cignY2xhc3MnKS5zcGxpdCgnICcpWzFdOy8vZ2V0IHRoZSAuZGF5PG51bWJlcj4gY2xhc3Mgb2YgbmV4dCBpbWFnZSBlbGVtZW50XHJcblxyXG4gICAgICAgIHJlc2V0KCk7XHJcbiAgICAgICAgJGJvZHkuYWRkQ2xhc3MoJ25vLXNjcm9sbCcpOy8vZGlzYWJsZSBzY3JvbGxpbmcgd2hlbiBtb2RhbCBhY3RpdmVcclxuXHJcbiAgICAgICAgJG1vZGFsTmF2LmZpbmQoJyNkYXknKS5odG1sKG5hdi5idG5MYWJlbHNbZGF5TnVtIC0gMV0pO1xyXG4gICAgICAgICRtb2RhbE5hdi5maW5kKCcjZGF5JykuYWRkQ2xhc3MoY2xpY2tlZENsYXNzKTtcclxuICAgICAgICAkbmV4dFBpYy5hZGRDbGFzcygnaW1hZ2Utd3JhcHBlci1hY3RpdmUnKTtcclxuICAgICAgICAkbmV4dFBpYy5maW5kKCcudmlldycpLmFkZENsYXNzKCd2aWV3LWFjdGl2ZScpO1xyXG4gICAgICAgICRuZXh0UGljLmZpbmQoJy5maWx0ZXItaW5kaWNhdG9yJykuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICBsYXp5TG9hZC5sb2FkSW1hZ2VzKCk7Ly9sb2FkIHRoYXQgYXJlIGJlaW5nIG5hdmlnYXRlZCB0aHJvdWdoXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcHJldigpIHtcclxuICAgICAgICB2YXIgJHByZXZQaWMgPSAkKCcuaW1hZ2Utd3JhcHBlci1hY3RpdmUnKS5wcmV2KCk7XHJcblxyXG4gICAgICAgIGlmICgkcHJldlBpYy5jc3MoJ2Rpc3BsYXknKSA9PT0gJ25vbmUnIHx8IHR5cGVvZiAkcHJldlBpYy5jc3MoJ2Rpc3BsYXknKSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJCgnLmZpbHRlci1pbmRpY2F0b3InKS5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xyXG5cclxuICAgICAgICAkbW9kYWxOYXYuZmluZCgnI2RheScpLnJlbW92ZUNsYXNzKCk7XHJcblxyXG4gICAgICAgIHZhciBkYXlOdW0gPSAkcHJldlBpYy5maW5kKCcuZmlsdGVyLWluZGljYXRvcicpLmF0dHIoJ2NsYXNzJykuc3BsaXQoJyAnKVsxXS5tYXRjaCgvXFxkLylbMF07XHJcbiAgICAgICAgdmFyIGNsaWNrZWRDbGFzcyA9ICRwcmV2UGljLmZpbmQoJy5maWx0ZXItaW5kaWNhdG9yJykuYXR0cignY2xhc3MnKS5zcGxpdCgnICcpWzFdO1xyXG5cclxuICAgICAgICByZXNldCgpO1xyXG4gICAgICAgICRib2R5LmFkZENsYXNzKCduby1zY3JvbGwnKTtcclxuXHJcbiAgICAgICAgJG1vZGFsTmF2LmZpbmQoJyNkYXknKS5odG1sKG5hdi5idG5MYWJlbHNbZGF5TnVtIC0gMV0pO1xyXG4gICAgICAgICRtb2RhbE5hdi5maW5kKCcjZGF5JykuYWRkQ2xhc3MoY2xpY2tlZENsYXNzKTtcclxuICAgICAgICAkcHJldlBpYy5hZGRDbGFzcygnaW1hZ2Utd3JhcHBlci1hY3RpdmUnKTtcclxuICAgICAgICAkcHJldlBpYy5maW5kKCcudmlldycpLmFkZENsYXNzKCd2aWV3LWFjdGl2ZScpO1xyXG4gICAgICAgICRwcmV2UGljLmZpbmQoJy5maWx0ZXItaW5kaWNhdG9yJykuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICBsYXp5TG9hZC5sb2FkSW1hZ2VzKCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHJlc2V0KCkge1xyXG4gICAgICAgICQoJy5pbWFnZS13cmFwcGVyJykucmVtb3ZlQ2xhc3MoJ2ltYWdlLXdyYXBwZXItYWN0aXZlJyk7XHJcbiAgICAgICAgJCgnLnZpZXcnKS5yZW1vdmVDbGFzcygndmlldy1hY3RpdmUnKTtcclxuICAgICAgICAkYm9keS5yZW1vdmVDbGFzcygnbm8tc2Nyb2xsJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHZpZXdBY3RpdmUoJHRoaXMpIHtcclxuICAgICAgICB2YXIgZGF5TnVtID0gJHRoaXMuZmluZCgnLmZpbHRlci1pbmRpY2F0b3InKS5hdHRyKCdjbGFzcycpLnNwbGl0KCcgJylbMV0ubWF0Y2goL1xcZC8pWzBdOy8vZ2V0IHRoZSBudW1iZXIgb2YgLmRheTxudW1iZXI+IGNsYXNzIG9mIGltYWdlIGVsZW1lbnQgdG8gdXNlIHdpdGggbmF2LmJ0bkxhYmVsc1xyXG4gICAgICAgIHZhciBjbGlja2VkQ2xhc3MgPSAkdGhpcy5maW5kKCcuZmlsdGVyLWluZGljYXRvcicpLmF0dHIoJ2NsYXNzJykuc3BsaXQoJyAnKVsxXTsvL2dldCB0aGUgLmRheTxudW1iZXI+IGNsYXNzIG9mIGltYWdlIGVsZW1lbnRcclxuXHJcbiAgICAgICAgJG1vZGFsTmF2LmZpbmQoJyNkYXknKS5yZW1vdmVDbGFzcygpO1xyXG5cclxuICAgICAgICAkYm9keS5hZGRDbGFzcygnbm8tc2Nyb2xsJyk7XHJcbiAgICAgICAgJG1vZGFsLnNob3coKTtcclxuICAgICAgICAkdGhpcy5hZGRDbGFzcygnaW1hZ2Utd3JhcHBlci1hY3RpdmUnKTtcclxuICAgICAgICAkdGhpcy5maW5kKCcudmlldycpLmFkZENsYXNzKCd2aWV3LWFjdGl2ZScpO1xyXG4gICAgICAgICR0aGlzLmZpbmQoJy5maWx0ZXItaW5kaWNhdG9yJykuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICAkbW9kYWxOYXYuZmluZCgnI2RheScpLmh0bWwobmF2LmJ0bkxhYmVsc1tkYXlOdW0gLSAxXSk7XHJcbiAgICAgICAgJG1vZGFsTmF2LmZpbmQoJyNkYXknKS5hZGRDbGFzcyhjbGlja2VkQ2xhc3MpO1xyXG4gICAgfVxyXG59KSgpOyJdfQ==
